# Improvement Tracker

## Done
- Enforced runtime budget checks across all major phases and search loops.
- Added phase-aware periodic status updates from initialization through finalization.
- Moved enemy URF presets into a data file:
  - `Simulation/data/enemy_urf_presets.json`
  - Includes source links and last checked date.
- Added strict startup validation for enemy preset items, runes, shards, and masteries.
- Added structured run output JSON:
  - default path mirrors markdown report with `.json` extension.
- Added search quality profiles:
  - `fast`
  - `balanced`
  - `maximum_quality`
- Replaced full permutation build order search with beam plus optimistic bound pruning.
- Build-order optimization now uses composite stage objective accumulation:
  - time alive
  - damage dealt
  - healing done
  - per-stage objective components are emitted in reports/JSON output.
- Added regression tests for legality and key rules.
- Added persistent full-score cache across runs under:
  - `Simulation/output/cache/`
- Added first-pass module split for simulation extensions:
  - `src/respawn.rs`
  - `src/scripts/vladimir.rs`
- Added additional modular extraction for orchestration support:
  - `src/cache.rs`
  - `src/status.rs`
- Added additional module split for maintainability:
  - `src/core.rs`
  - `src/build_order.rs`
  - `src/reporting.rs`
  - `src/search.rs`
  - `src/scenario_runner.rs`
  - `src/engine.rs`
  - `src/data.rs`
- Added enemy lifecycle simulation:
  - enemies can die from Vladimir damage
  - enemies respawn using URF-scaled death timer logic
- Added first-pass scripted Vladimir offensive cadence:
  - `Q`, `E`, and `R` damage/heal behavior integrated into the event loop
- Added strict final ranking parallel batches using Rayon for faster full candidate scoring.
- Added cap-survivor handling in output and tie-break:
  - cap-survivor labeling in reports/output
  - tie-break uses existing objective damage/healing weights
- Added first-pass script hook framework for non-generic mechanics:
  - `src/scripts/hooks.rs` dispatches item/champion/loadout hooks
  - `src/scripts/item_hooks.rs` now owns Heartsteel stack assumptions
  - `src/scripts/vladimir.rs` now owns Crimson Pact stat conversion logic
  - `src/scripts/loadout_hooks.rs` now annotates dynamic rune/mastery effects
- Added first-pass 2D action timeline realism:
  - enemies are placed in 2D range bands around Vladimir and remain stationary
  - auto-attacks use start/windup/hit phases
  - ranged attacks and enemy spells use projectile travel time
  - Vladimir `Q`/`E`/`R` now use cast windup timing (and travel where configured)
- Added first-pass enemy champion behavior script profiles:
  - Warwick
  - Vayne
  - Morgana
  - Sona
  - Doctor Mundo
- Added repository automation workflows:
  - pull request and main branch continuous integration in `.github/workflows/continuous-integration.yml`
  - tag-based release generation with findings in `.github/workflows/release.yml`
- Enforced strict lint gating:
  - all current code passes `cargo clippy --all-targets --all-features -- -D warnings`
  - CI now hard-fails on any new Clippy warning.
- Added enemy derived-combat diagnostics and similarity warnings:
  - report/JSON output now includes per-enemy HP/AD/AS/range/hit/burst derived stats
  - warns when enemy auto-attack profiles look suspiciously similar
- Improved death/respawn state realism:
  - transient stack counters clear on enemy death and respawn
  - enemies respawn at their original spawn position
- Improved scripted event lifecycle correctness:
  - scripted champion events are epoch-gated across death/respawn and uptime-window transitions
  - stale queued script events are invalidated instead of leaking across lifecycle transitions
- Fixed projectile-blocking segment intersection edge cases:
  - colinear-but-disjoint projectile paths no longer register as blocked

## Not Done
- [P0] Full-fidelity Vladimir kit simulation (`Q`, `E`, `R`, passives)
  - Goal: upgrade first-pass scripted abilities to closer in-game behavior fidelity.
  - Scope:
    - Add full spell-state nuances, empowered states, and target-selection details.
    - Model cast times/windups and expected hit geometry with position model.
    - Preserve deterministic tick/event behavior.
  - Success criteria:
    - Offensive outcomes track expected ability scaling and timing behavior more closely.
    - Unit tests cover ability cooldown and cast ordering invariants.

- [P1] Composite objective refinement and guardrails
  - Goal: improve build quality under mixed metrics while avoiding pathological results.
  - Scope:
    - Add survivability floor gating for obviously non-viable builds.
    - Add optional diminishing returns/soft caps for damage and healing components.
    - Emit per-scenario component breakdown in reports.
  - Success criteria:
    - Top builds satisfy survivability floor.
    - Reports clearly explain why a build scored highly.

- [P2] Expand script hooks to full mechanic coverage
  - Goal: extend hook coverage for all non-generic item/champion/rune/mastery behavior.
  - Scope:
    - Add script implementations for additional stack items and champion passives.
    - Add hook-driven combat-time rune/mastery behavior (not only notes).
    - Keep hooks deterministic and compatible with search parallelism.
  - Success criteria:
    - Multiple complex mechanics implemented entirely through hooks.
    - No regression to strict candidate search stability.

- [P2] Robustness and stability sweeps
  - Goal: distinguish stable winners from seed/weight-sensitive outliers.
  - Scope:
    - Run multi-seed and multi-weight preset sweeps.
    - Summarize robust versus fragile builds in report output.
  - Success criteria:
    - Report explicitly identifies high-confidence stable loadouts.
    - Repeat runs show reduced variance in recommended top builds.


- [P0] Action timeline realism follow-up (blocking, collision, movement)
  - Goal: complete fidelity work beyond current 2D+windup+travel model.
  - Scope:
    - Add projectile-blocking interactions where applicable.
    - Add collision/pathing-aware projectile resolution.
    - Add explicit movement updates for champions (currently stationary).
  - Success criteria:
    - Projectile-block interactions are represented in combat outcomes.
    - Position changes and movement materially affect hit timing and uptime.

- [P1] Enemy ability simulation depth for champion scripts
  - Goal: deepen champion kit fidelity beyond first-pass behavior profiles.
  - Scope:
    - Expand per-champion scripts beyond profile-level timing and on-hit effects.
    - Add ability-state interactions and per-champion sequencing nuances.
    - Keep scripts outside the core engine loop and data-driven where possible.
  - Success criteria:
    - Enemy champions show distinct, kit-driven combat timelines.
    - Script modules are testable independently from the core simulation engine.

- [P1] Preset/build correctness audit (enemy autos and itemization variance)
  - Goal: explain and fix cases where enemy champions appear to use overly similar auto-attack behavior/build outcomes.
  - Scope:
    - Audit enemy preset ingestion and per-champion stat application.
    - Verify item/rune/mastery effects are applied distinctly per champion.
    - Add validation/report checks to flag suspiciously similar enemy profiles.
  - Success criteria:
    - Per-enemy derived combat stats are printed in diagnostics.
    - Champion-to-champion auto attack profiles materially differ where expected.

- [P1] Codebase modularization and script-friendly architecture
  - Goal: eliminate single-file bottleneck and keep champion/item logic out of `main.rs`.
  - Scope:
    - Split core into modules (engine, search, reporting, data loading, scripts, CLI).
    - Move item/champion/mastery special cases into dedicated script modules/hooks.
    - Define clear interfaces for extending champion/item behavior.
  - Success criteria:
    - `main.rs` becomes a thin CLI orchestration entrypoint.
    - New champion/item behavior can be added without touching core engine files.

- [P1] CI/CD for pull requests, main branch, and releases
  - Goal: automate quality checks and release artifacts with run findings.
  - Scope:
    - Add CI workflows for pull requests and main:
      - build
      - test
      - formatting/lint gates
    - Add release workflow that packages binary and attaches generated findings/report summary.
  - Success criteria:
    - PRs and main branch enforce green checks.
    - Releases include artifacts plus generated run report in release notes/attachments.

- [P2] Repository quality gates (linting, style, module boundaries)
  - Goal: enforce maintainable structure and coding standards automatically.
  - Scope:
    - Add `rustfmt` and `clippy` checks in CI.
    - Add deny/warn policy for common maintainability issues.
    - Add lightweight module size/ownership conventions in docs.
  - Success criteria:
    - New changes consistently conform to style and lint rules.
    - Core simulation logic stays split across coherent modules over time.

## Open Questions
- Enemy respawn behavior:
  - Implement using URF death timer scaling by level (not a fixed `20.0s`).
  - Decision:
    - Use documented SR level scaling through level 18, then extrapolate smoothly for levels 19-30 with conservative clamping.
    - Apply URF modifier (minus 3 seconds) on top of the scaled timer.
    - Keep the respawn timer model configurable so we can swap in a verified full table later.
    - cooldown timers continue while dead.
    - buffs/debuffs that do not persist through death are removed.
    - persist-through-death effects remain.
- Position model scope:
  - Decision:
    - Start with 1D range bands and deterministic spacing assumptions.
    - Expand to 2D coordinates in a follow-up after projectile travel/blocking is stable.
- Cap-survivor ranking:
  - Decision:
    - Use combined `damage dealt + healing done` tie-break metric.
    - Reuse existing objective weights (no separate custom weighting logic).

## Research Notes (2026-02-15)
- URF death timer patch history:
  - `V13.1b` entry explicitly states: "Death timers reduced by 3 seconds at all levels."
  - No newer URF patch-history entry found that explicitly reverts this.
  - Sources:
    - https://www.leagueoflegends.com/en-us/news/game-updates/patch-13-1b-notes/
    - https://wiki.leagueoflegends.com/en-us/Ultra_Rapid_Fire/Patch_and_Buff_History
- Baseline death timer model (SR reference):
  - Base Respawn Wait by level (1-18): `10, 10, 12, 12, 14, 16, 20, 25, 28, 32.5, 35, 37.5, 40, 42.5, 45, 47.5, 50, 52.5` seconds.
  - Time Increase Factor applies by game time after 15 minutes (with cap).
  - Sources:
    - https://wiki.leagueoflegends.com/en-us/Death
    - https://leagueoflegends.fandom.com/wiki/Death
- Death-state effects:
  - Documented behavior indicates many buffs/debuffs are removed on death unless marked to persist through death.
  - Cooldown behavior should be treated as continuing through death unless contradicted by targeted in-client validation.
  - Sources:
    - https://wiki.leagueoflegends.com/en-us/Death
    - https://leagueoflegends.fandom.com/wiki/Death
